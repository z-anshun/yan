<!DOCTYPE html>

<html lang="en">
<!-- Head -->

<head>

    <meta charset="UTF-8">
    <title>五子棋</title>

    <style type="text/css">

        #container {
            position: relative;
            width: 531px;
            height: 645px;
            margin: 0 auto;
            border: 1px solid blue;
            /*background: url(qipan.jpg) no-repeat;*/
            padding-top: 0;
            padding-left: 5px;

        }


        td {
            border: 1px solid #ccc;
            cursor: pointer;
            width: 40px;
            height: 33px;
        }


        table {
            position: absolute;
            border-collapse: collapse;
            width: 525px;
            height: 465px;

        }

        .chat {
            position: relative;
            float: left;
            height: 400px;
            width: 300px;

            margin-top: 190px;
            margin-left: 20px;
            border: 1px solid skyblue;
        }

        #form {
            padding: 0 0.5em 0 0.5em;
            margin: 0;
            position: absolute;
            bottom: 1em;
            left: 0;

            overflow: hidden;


        }

        .chat #msg {
            width: 200px;
            height: 25px;
            margin-bottom: 0;
        }
        .choice{
            position: absolute;
            margin-left: 100px;
            margin-top: 515px;
        }
    </style>
    <!-- css ends -->
    <!-- script -->

    <!-- script ends -->

</head>
<!-- Head Ends -->
<!-- Body -->

<body>
<!-- Container -->
<div class="chat">
    <div id="log"></div>
    <form id="form">
        <input type="text" id="msg" size="64"/>

        <input type="submit" value="发送"/>

    </form>

</div>
<div id="container">

    <table>

        <tr>

            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>

        </tr>

        <tr>

            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>

        </tr>

        <tr>

            <td>&nbsp;</td>

            <td>&nbsp;</td>

            <td>&nbsp;</td>

            <td>&nbsp;</td>

            <td>&nbsp;</td>

            <td>&nbsp;</td>

            <td>&nbsp;</td>

            <td>&nbsp;</td>

            <td>&nbsp;</td>

            <td>&nbsp;</td>

            <td>&nbsp;</td>

            <td>&nbsp;</td>

            <td>&nbsp;</td>

            <td>&nbsp;</td>

            <td>&nbsp;</td>

        </tr>

        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </table>

    <!-- 控件模块 -->
    <br>
    <div class="choice">
        <p>&nbsp当前棋手：

            <input type="button" value="认输" onclick="status1()">
            <input type="button" value="求和" onclick="status2()">
            <input type="button" value="悔棋" onclick="status3()">
            <input type="button" value="退出游戏" onclick="closeFunction()">
        </p>
    </div>
</div>
<!-- Container Ends -->
</body>
<!-- Body Ends -->
</html>
<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script>
    var cookie = {
        set: function (key, val, time) {//设置cookie方法
            var date = new Date() //获取当前时间
            var expiresDays = time  //将date设置为n天以后的时间
            date.setTime(date.getTime() + expiresDays * 24 * 3600 * 1000) //格式化为cookie识别的时间
            document.cookie = key + "=" + val + ";expires=" + date.toGMTString() + ";secure=false;path = /"
            ;  //设置cookie
        },
        get: function (key) {//获取cookie方法
            /*获取cookie参数*/
            var getCookie = document.cookie.replace(/[ ]/g, "")  //获取cookie，并且将获得的cookie格式化，去掉空格字符
            var arrCookie = getCookie.split(";")  //将获得的cookie以"分号"为标识 将cookie保存到arrCookie的数组中
            var tips;  //声明变量tips
            for (var i = 0; i < arrCookie.length; i++) {   //使用for循环查找cookie中的tips变量
                var arr = arrCookie[i].split("=")  //将单条cookie用"等号"为标识，将单条cookie保存为arr数组
                if (key == arr[0]) {  //匹配变量名称，其中arr[0]是指的cookie名称，如果该条变量为tips则执行判断语句中的赋值操作
                    tips = arr[1]  //将cookie的值赋给变量tips
                    break   //终止for循环遍历
                }
            }
            return tips;
        }
    }


    function closeFunction() {
        if (confirm("是否退出游戏？")) {
            window.close();
        }else{

        }
    }

    function status1() {
        let k = {}
        k['content'] = ""
        k['name'] = name
        k['code'] = 1
        let str = JSON.stringify(k)
        conn.send(str);
    }

    function status2() {
        let k = {}
        k['content'] = ""
        k['name'] = name
        k['code'] = 2
        let str = JSON.stringify(k)
        conn.send(str);
    }

    function status3() {
        let k = {}
        k['content'] = ""
        k['name'] = name
        k['code'] = 3
        let str = JSON.stringify(k)
        conn.send(str);
    }


    //获取房间号
    let id = cookie.get("roomID")
    let name = cookie.get("name")


    var conn = new WebSocket(`ws://101.201.140.26:8080/ws/` + id)
    var msg = $("#msg");
    var log = $("#log");

    conn.onopen = function (evt) {
        conn.send(cookie.get("token"))

    }
    if (name.length == 0) {
        alert("请先登录")
        window.location.href = "login.html"
    }

    function appendLog(msg) {
        var d = log[0];
        var doScroll = d.scrollTop == d.scrollHeight - d.clientHeight;
        msg.appendTo(log);
        if (doScroll) {
            d.scrollTop = d.scrollHeight - d.clientHeight;
        }
    }

    $("#form").submit(function () {
        if (!conn) {
            console.log(msg.val());
            return false;
        }
        if (!msg.val()) {
            return false;
        }
        // let name=getCookie("name")
        //  if(name!=""){
        //    conn.send(name+":")
        //  }
        // type Inter struct {
        //     //0为交流 1认输  2求和  3悔棋
        //     Name    string `json:"name"`
        //     Code    int    `json:"code"`
        //     Action  string `json:"action"`  //落子的地方 用,隔开 （x,y）
        //     Content string `json:"content"` //聊天
        // }

        let k = {}
        k['content'] = msg.val()

        k['name'] = name

        k['code'] = 0
        let str = JSON.stringify(k)
        conn.send(str);
        msg.val("");
        return false
    });

    if (window["WebSocket"]) {

        conn.onmessage = function (evt) {
            //把传输过来的数据json化
            let con = JSON.parse(evt.data);

            console.log(con)

            let user = con.name + ":";
            if (con.name.length == 0) {
                user = "";
            }
            appendLog($("<div style='font-weight: 700 '/>").text(user));
            appendLog($("<div>").text(con.content))

        };
        conn.onclose = function (evt) {

            appendLog($("<div><b>The Room is Closed.</b></div>"))


        };


    } else {
        appendLog($("<div><b>WebSockets Not Support.</b></div>"))
    }


</script>